<?php
require 'connection.php';


$aviso = '';
$color = '';
$titulo = '';
$autor = '';
$ano = '';
$categoria = '';
$quantidade = '';


if ($_SERVER['REQUEST_METHOD'] == 'POST') {






    $titulo_raw = trim($_POST['titulo']);
    $autor_raw = trim($_POST['autor']);
    $ano_raw = trim($_POST['ano']) ;
    $categoria_raw =trim($_POST['categoria']) ;
    $quantidade_raw = trim($_POST['quantidade']) ;






    $titulo = mysqli_real_escape_string($conn, $_POST['titulo']);
    $autor = mysqli_real_escape_string($conn, $_POST['autor']);
    $ano = mysqli_real_escape_string($conn, $_POST['ano']);
    $categoria = mysqli_real_escape_string($conn, $_POST['categoria']);
    $quantidade = mysqli_real_escape_string($conn, $_POST['quantidade']);


    if (empty($titulo) ) {
        $aviso = 'Escreve o título arrombado!!';
        $color = 'erro';
    } elseif (empty($categoria)) {
        $aviso = 'Seleciona essa merda!!!!!';
        $color = 'erro';
    } elseif (empty($autor)) {
        $aviso = 'Preencha o Dono vagabundo!';
        $color = 'erro';
    } elseif (empty($ano)) {
        $aviso = 'Preencha o ano arrombado!';
        $color = 'erro';
    } elseif (empty($quantidade) || !is_numeric($quantidade) || $quantidade < 1) {
        $aviso = 'A quantidade deve ser um número maior que zero!';
        $color = 'erro';
    }


    // validação espaço
       elseif ($titulo_raw === '' || $autor_raw === '' || $ano_raw === '' || $categoria_raw === '' || $quantidade_raw === ''){
        $aviso = 'tá achando que me pegou no espaço';
        $color = 'erro';




    } else {
        $sql = "INSERT INTO livros (titulo, autor, ano, categoria, quantidade)
                        VALUES ('$titulo', '$autor', '$ano', '$categoria', '$quantidade')";


        if (mysqli_query($conn, $sql)) {
            $aviso = 'Livro "' . $titulo . '" cadastrado com sucesso!';
            $color = 'sucesso';


            $titulo = $autor = $ano = $categoria = $quantidade = '';
        } else {
            $aviso = 'Erro ao cadastrar: ' . mysqli_error($conn);
            $color = 'erro';
        }
    }
}


$categorias = array('Romance', 'Didático', 'Fantasia', 'Ficção Científica', 'História', 'Biografia', 'Autoajuda', 'Infantil');
?>


<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Livros</title>
</head>
<body>
    <?php if (!empty($aviso)): ?>
        <div class="<?= $color ?>">
            <?= htmlspecialchars($aviso) ?>
        </div>
    <?php endif; ?>


    <form method="POST">
        <input type="text" id="titulo" name="titulo" placeholder="titulo" maxlength="120" value="<?= htmlspecialchars($titulo) ?>">


        <input type="text" id="autor" name="autor" placeholder="autor" maxlength="100" value="<?= htmlspecialchars($autor) ?>">


        <input type="number" id="ano" name="ano" placeholder="Ex: 1945" min="1" max="2099" value="<?= htmlspecialchars($ano) ?>">


        <select id="categoria" name="categoria" required>
            <option value="">Selecione uma categoria</option>
            <?php for ($i = 0; $i < count($categorias); $i++): ?>
                <option value="<?php echo $categorias[$i]; ?>"
                    <?php if ($categoria == $categorias[$i]) echo 'selected'; ?>>
                    <?php echo $categorias[$i]; ?>
                </option>
            <?php endfor; ?>
        </select>


        <input type="number" id="quantidade" name="quantidade" placeholder="quantidade" min="1" max="999999" value="<?= htmlspecialchars($quantidade) ?>">


        <button type="submit" id="enviar" name="enviar">Enviar</button>
        <button type="reset">Limpar</button>
    </form>
</body>
</html>




